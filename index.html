        // Configuration des questions du quiz (votre code existant)
        const quizQuestions = [
            // ... (vos questions ici) ...
             {
                question: "How do you say \"My name is\"? (informal)",
                options: ["Je m'appelle", "Je viens vous", "J'ai le nommé", "J'ai une montre"],
                correctAnswer: "Je m'appelle",
                explanation: "Literally, \"I call myself\"."
            },
            {
                question: "How do you say \"I'm from New Orleans\"?",
                options: ["J'aime la Nouvelle-Orléans.", "Je habiter Nouvelle-Orléans.", "Je viens de la Nouvelle-Orléans.", "All of the above"],
                correctAnswer: "Je viens de la Nouvelle-Orléans.",
                explanation: "This is the most natural and idiomatic way to say \"I am from New Orleans\" in French. The verb \"venir de\" (to come from) is commonly used to express origin or birthplace.<br><br>\"J'aime la Nouvelle-Orléans\" means \"I love New Orleans.\" This phrase doesn't accurately convey the meaning of \"being from\" a place.<br><br>\"Je habiter à la Nouvelle-Orléans\" means \"I to inhabit at New Orleans.\" This phrase is not grammatically correct and sounds awkward."
            },
            {
                question: "How do you say \"You're welcome\"?",
                options: ["De rien", "Avec plaisir", "Je vous en prie", "All of the above"],
                correctAnswer: "All of the above",
                explanation: "All the answers are correct.<br><br>\"De rien\" is the most common and casual way to say you're welcome, and it literally means \"it's nothing\".<br><br>\"Avec plaisir\" means with pleasure, and it's a friendly and enthusiastic way to say \"you're welcome\".<br><br>\"Je vous en prie\" is a formal and polite way to say you're welcome, and it literally means \"I beg of you\".<br><br>Cultural insight for \"je vous en prie\": its roots lie in the Middle Ages, likely emerging around the 13th-14th centuries. Back then, \"prier\" (to pray) wasn't just about requesting or begging, it also carried a strong sense of expressing reverence and devotion."
            },
            {
                question: "How do you say \"Good evening\"? (as a hello)",
                options: ["Bonne nuit", "Bonsoir", "Bon après-midi", "Bonne soirée"],
                correctAnswer: "Bonsoir",
                explanation: "\"Bonsoir\" is the correct way to say good evening in French.<br><br>\"Bonne nuit\" means good night, and it's used when you're going to bed or leaving someone for the night.<br><br>\"Bon après-midi\" means good afternoon.<br><br>\"Bonne soirée\" means \"have a good evening\" and specifically conveys the hope that someone has a pleasant evening ahead."
            },
            {
                question: "How do you say \"How are you doing\"? (formal)",
                options: ["Comment allez-vous ?", "Ça boom ?", "C'est beau la vie ?", "All of the above"],
                correctAnswer: "Comment allez-vous ?",
                explanation: "\"Comment allez-vous ?\" is the formal and polite way to ask, and it's used with strangers, acquaintances, or superiors.<br><br>\"Ça boom ?\" is very casual and a bit outdated (not formal).<br><br>\"C'est beau la vie ?\" is informal and friendly, and it's used with friends."
            },
            {
                question: "Listen to this. What is she saying?",
                options: ["Tu viens chez moi ?", "Tu vas loin ?", "Tu viens d'où ?", "Tu tiens ton chien ?"],
                correctAnswer: "Tu viens d'où ?",
                explanation: "<strong>\"Tu viens d'où ?\"</strong> <em>(Where are you from?)</em>",
                audio: "audio/TYF_Lead_6.mp3"
            },
            {
                question: "Listen to this. What is she saying?",
                options: ["Tu es étudiant ?", "Tu pars où ?", "Tu étudies à l'université ?", "Tu as étudié où ?"],
                correctAnswer: "Tu as étudié où ?",
                explanation: "<strong>\"Tu as étudié où ?\"</strong> <em>(Where did you study?)</em>",
                audio: "audio/TYF_Lead_7.mp3"
            },
            {
                question: "Bonjour, c'est la première fois que je viens. Je ________ ? (fill the blank)",
                options: ["veux vous boire la verre ?", "vois la musique est bonne ?", "peux m'asseoir ici", "vous excuse pas du tout ?"],
                correctAnswer: "peux m'asseoir ici",
                explanation: "<strong>\"Bonjour, c'est la première fois que je viens. Je peux m'asseoir ici ?\"</strong><br><em>(Hello, this is my first time here. May I sit here?)</em><br><br>The other options are not grammatically correct."
            },
            {
                question: "Excusez-moi, je tourne en rond. ___ ? (fill the blank)",
                options: ["Pouvez-vous m'indiquer le chemin pour le Louvre s'il vous plait", "Montrez chemin musée sur carte.", "Je veux Louvre maintenant.", "All of the above"],
                correctAnswer: "Pouvez-vous m'indiquer le chemin pour le Louvre s'il vous plait",
                explanation: "<strong>\"Excusez-moi, je tourne en rond. Pouvez-vous m'indiquer le chemin pour le Louvre s'il vous plait ?\"</strong><br><em>(Excuse me, I'm going round in circles/I'm lost. Could you please show me the way to the Louvre?)</em><br><br>It's the only sentence that is correct grammatically and that is polite and accurate.<br><br>\"Montrez chemin musée carte.\" This is not a question, but rather a request with a list of words and this does not specify which museum.<br><br>\"Je veux Louvre maintenant.\" It doesn't explicitly ask someone to provide guidance on how to get there and it sounds rude.<br><br><strong>Tip:</strong> in France, it is always best to say \"s'il vous plait\" in all your interactions."
            },
            {
                question: "________ m'inscrire à ce cours. (fill the blank)",
                options: ["Je suis en voiture", "Tu veux le vélo pour", "Je cherche un lapin", "Bonjour, j'aimerais"],
                correctAnswer: "Bonjour, j'aimerais",
                explanation: "<strong>\"Bonjour, j'aimerais m'inscrire à ce cours.\"</strong><br><em>(Hello, I would like to register for this course.)</em><br><br>In French, we use the conditional of \"vouloir\" (to want) to ask for something politely.<br>Example: I would like a coffee."
            }
        ];

        // État du quiz (votre code existant)
        let currentQuestion = 0;
        let score = 0;
        let selectedAnswers = [];
        let questionStatus = []; // État de chaque question: null, 'correct', 'incorrect'
        let questionTimes = []; // Temps pour chaque question
        let startTime = null; // Temps de départ pour la question actuelle
        let timerEnabled = true; // Timer activé par défaut
        let timerInterval = null; // Intervalle du timer
        let totalTimeElapsed = 0; // Temps total écoulé pour le quiz

        // Éléments DOM - Regroupés par fonctionnalité (votre code existant)
        const DOM = {
             screens: {
                welcome: document.getElementById('welcome-screen'),
                quiz: document.getElementById('quiz-screen'),
                result: document.getElementById('result')
            },
            quiz: {
                container: document.getElementById('quiz'),
                feedback: document.getElementById('feedback'),
                progress: {
                    bar: document.getElementById('progress'),
                    steps: document.getElementById('progress-steps')
                },
                timer: {
                    container: document.getElementById('timer-display'),
                    value: document.getElementById('timer-value'),
                    toggle: document.getElementById('timer-toggle'),
                    checkbox: document.getElementById('enable-timer')
                }
            },
            results: {
                score: document.getElementById('score'),
                totalQuestions: document.getElementById('total-questions'),
                message: document.getElementById('score-message'),
                summary: document.getElementById('answers-summary'),
                stats: {
                    accuracy: document.getElementById('accuracy'),
                    avgTime: document.getElementById('avg-time'),
                    fastestAnswer: document.getElementById('fastest-answer'),
                    slowestAnswer: document.getElementById('slowest-answer')
                },
                certificate: {
                    container: document.getElementById('certificate'),
                    score: document.getElementById('certificate-score'),
                    total: document.getElementById('certificate-total'),
                    date: document.getElementById('certificate-date'),
                    name: document.getElementById('participant-name')
                },
                shareText: document.getElementById('share-text')
            },
            buttons: {
                start: document.getElementById('start-btn'),
                prev: document.getElementById('prev-btn'),
                next: document.getElementById('next-btn'),
                submit: document.getElementById('submit-btn'),
                restart: document.getElementById('restart-btn'),
                export: document.getElementById('export-btn'),
                print: document.getElementById('print-btn'),
                copy: document.getElementById('copy-btn')
            },
            questionCount: document.getElementById('question-count')
        };

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            DOM.questionCount.textContent = quizQuestions.length;
            initializeArrays();
            setupEventListeners();
            // Cacher l'écran des résultats initialement
            DOM.screens.result.style.display = 'none';
            DOM.screens.quiz.classList.add('hidden');

            document.querySelectorAll('.fade-in').forEach(el => {
                el.addEventListener('animationend', () => {
                    el.classList.remove('fade-in');
                });
            });
             DOM.screens.welcome.classList.remove('hidden'); // Assurer que l'accueil est visible
        });

        // Initialise les tableaux d'état
        function initializeArrays() {
            selectedAnswers = Array(quizQuestions.length).fill(null);
            questionStatus = Array(quizQuestions.length).fill(null);
            questionTimes = Array(quizQuestions.length).fill(0);
        }

        // Configure tous les écouteurs d'événements
        function setupEventListeners() {
            DOM.buttons.start.addEventListener('click', initQuiz);
            DOM.buttons.prev.addEventListener('click', goToPreviousQuestion);
            DOM.buttons.next.addEventListener('click', goToNextQuestion);
            DOM.buttons.submit.addEventListener('click', showResults);
            DOM.buttons.restart.addEventListener('click', restartQuiz);
            DOM.buttons.export.addEventListener('click', exportResults);
            DOM.buttons.print.addEventListener('click', printResults);
            DOM.quiz.timer.toggle.addEventListener('click', toggleTimer);
            DOM.quiz.timer.checkbox.addEventListener('change', (e) => {
                timerEnabled = e.target.checked;
            });
            DOM.buttons.copy.addEventListener('click', copyShareText);
        }

        // Démarre le quiz
        function initQuiz() {
            currentQuestion = 0;
            score = 0;
            totalTimeElapsed = 0; // Réinitialiser le temps total
            initializeArrays();

            if (timerEnabled) {
                DOM.quiz.timer.container.classList.remove('hidden', 'timer-hidden');
                DOM.quiz.timer.toggle.innerHTML = '<i class="fas fa-eye-slash"></i>'; // Reset toggle icon
                startTimer();
            } else {
                DOM.quiz.timer.container.classList.add('hidden');
                stopTimer(); // Assure que tout timer précédent est arrêté
            }

            showQuestion();
            createProgressSteps();
            updateProgressBar();

            // Transition des écrans
            DOM.screens.welcome.classList.add('fade-out');
             setTimeout(() => {
                DOM.screens.welcome.classList.add('hidden');
                DOM.screens.welcome.classList.remove('fade-out'); // Clean up class
                DOM.screens.quiz.classList.remove('hidden');
                DOM.screens.quiz.classList.add('fade-in');
                DOM.screens.result.style.display = 'none'; // Ensure result screen is hidden
                 // Focus on the quiz container or first question for accessibility
                 DOM.quiz.container.focus();
            }, 300); // Match CSS animation duration


            updateButtons();
        }

        // Fonctions du timer
        function startTimer() {
            if (!timerEnabled) return;
            startTime = new Date(); // Reset start time for the first question
            updateTimerDisplay(); // Affiche 00:00
            clearInterval(timerInterval); // Clear any existing interval
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null; // Clear interval ID
        }

        function updateTimerDisplay() {
            if (!timerEnabled || !startTime) return; // Add check for startTime

            const now = new Date();
            const currentQuestionTime = Math.floor((now - startTime) / 1000);
            const totalDisplayTime = totalTimeElapsed + currentQuestionTime; // Temps total affiché

            const minutes = Math.floor(totalDisplayTime / 60).toString().padStart(2, '0');
            const seconds = (totalDisplayTime % 60).toString().padStart(2, '0');
            DOM.quiz.timer.value.textContent = `${minutes}:${seconds}`;
        }

        function recordQuestionTime() {
            if (!timerEnabled || !startTime) return;
            const endTime = new Date();
            const timeTaken = Math.floor((endTime - startTime) / 1000);
            questionTimes[currentQuestion] = timeTaken;
            totalTimeElapsed += timeTaken; // Ajoute le temps de cette question au total
             startTime = new Date(); // Reset start time for the NEXT question immediately
        }

        function toggleTimer() {
            const timerContainer = DOM.quiz.timer.container;
            const isHidden = timerContainer.classList.toggle('timer-hidden');
            if (isHidden) {
                DOM.quiz.timer.toggle.innerHTML = '<i class="fas fa-eye"></i>';
                DOM.quiz.timer.toggle.setAttribute('aria-label', 'Afficher le chronomètre');
            } else {
                DOM.quiz.timer.toggle.innerHTML = '<i class="fas fa-eye-slash"></i>';
                DOM.quiz.timer.toggle.setAttribute('aria-label', 'Masquer le chronomètre');
            }
        }

        // Crée les étapes de progression
        function createProgressSteps() {
            DOM.quiz.progress.steps.innerHTML = '';
            for (let i = 0; i < quizQuestions.length; i++) {
                const step = document.createElement('div');
                step.className = 'step';
                step.textContent = i + 1;
                step.setAttribute('aria-label', `Question ${i + 1}`);

                if (i === currentQuestion) {
                    step.classList.add('active');
                    step.setAttribute('aria-current', 'true');
                } else if (questionStatus[i] === 'correct') {
                    step.classList.add('completed');
                    step.setAttribute('aria-label', `Question ${i + 1} - Correcte`);
                } else if (questionStatus[i] === 'incorrect') {
                    step.classList.add('error');
                     step.setAttribute('aria-label', `Question ${i + 1} - Incorrecte`);
                } else {
                     step.setAttribute('aria-label', `Question ${i + 1} - Non répondue`);
                }
                DOM.quiz.progress.steps.appendChild(step);
            }
        }

        // Affiche la question actuelle
        function showQuestion() {
            const question = quizQuestions[currentQuestion];
            let questionHTML = `
                <fieldset class="question-container fade-in" id="question-${currentQuestion + 1}" aria-labelledby="question-text-${currentQuestion + 1}">
                    <legend class="sr-only">Question ${currentQuestion + 1}</legend>
                    <p class="question-text" id="question-text-${currentQuestion + 1}">${question.question}</p>
            `;

            if (question.audio) {
                questionHTML += `
                    <div class="audio-container">
                        <audio controls>
                            <source src="${question.audio}" type="audio/mpeg">
                            Votre navigateur ne supporte pas l'élément audio.
                        </audio>
                    </div>
                `;
            }

            questionHTML += `<div class="options" role="radiogroup" aria-labelledby="question-text-${currentQuestion + 1}">`;

            question.options.forEach((option, index) => {
                const isSelected = selectedAnswers[currentQuestion] === option;
                let optionClass = 'option';
                 let ariaChecked = 'false';

                 if (isSelected) {
                    optionClass += ' selected';
                    ariaChecked = 'true';
                     if (questionStatus[currentQuestion] === 'correct') {
                        optionClass += ' correct';
                    } else if (questionStatus[currentQuestion] === 'incorrect') {
                        optionClass += ' incorrect';
                    }
                }
                 // Highlight correct answer if already answered incorrectly
                 else if (questionStatus[currentQuestion] === 'incorrect' && option === question.correctAnswer) {
                     optionClass += ' correct'; // Show correct answer after incorrect selection
                 }


                questionHTML += `
                    <div class="${optionClass}"
                         data-index="${index}"
                         role="radio"
                         aria-checked="${ariaChecked}"
                         tabindex="${questionStatus[currentQuestion] ? '-1' : '0'}"> <!-- Disable focus if answered -->
                        ${option}
                    </div>
                `;
            });

            questionHTML += `</div></fieldset>`;
            DOM.quiz.container.innerHTML = questionHTML;

            // Clear and potentially show feedback
            DOM.quiz.feedback.classList.remove('visible');
            DOM.quiz.feedback.innerHTML = '';
             if (questionStatus[currentQuestion]) { // If already answered
                 updateFeedback(); // Show feedback immediately
                 disableOptions(); // Ensure options are disabled
             } else {
                 attachOptionEventListeners(); // Only attach listeners if not answered
             }

            updateButtons();
            updateProgressBar();
            createProgressSteps();

             // Reset start time only if the question hasn't been answered yet
            if (!questionStatus[currentQuestion]) {
                startTime = new Date();
            }

             // Focus logic
            setTimeout(() => {
                 const focusTarget = document.querySelector('.option[tabindex="0"]'); // Focus first available option
                 if (focusTarget) {
                    focusTarget.focus();
                } else {
                    // If no options are focusable (already answered), focus the container or next button
                    DOM.buttons.next.focus();
                 }
             }, 100); // Small delay for fade-in
        }


        // Attache les écouteurs d'événements aux options
        function attachOptionEventListeners() {
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                if(option.getAttribute('tabindex') === '0') { // Only attach if focusable
                    option.addEventListener('click', selectOption);
                    option.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            selectOption({ target: option });
                        }
                    });
                }
            });
        }

        // Gère la sélection d'une option
        function selectOption(event) {
            const selectedOptionElement = event.target.closest('.option'); // Ensure we get the .option div
            if (!selectedOptionElement || questionStatus[currentQuestion]) return; // Already answered or not an option

            recordQuestionTime(); // Record time when an answer is selected

            const selectedIndex = parseInt(selectedOptionElement.dataset.index);
            const selectedAnswerText = quizQuestions[currentQuestion].options[selectedIndex];
            const correctAnswerText = quizQuestions[currentQuestion].correctAnswer;

            selectedAnswers[currentQuestion] = selectedAnswerText;

            // Determine correctness
            if (selectedAnswerText === correctAnswerText) {
                questionStatus[currentQuestion] = 'correct';
                score++; // Increment score only when first answered correctly
            } else {
                questionStatus[currentQuestion] = 'incorrect';
            }

             // Update visual state of options
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.classList.remove('selected');
                 opt.setAttribute('aria-checked', 'false');
                opt.setAttribute('tabindex', '-1'); // Make non-interactive after selection
            });

            selectedOptionElement.classList.add('selected');
            selectedOptionElement.setAttribute('aria-checked', 'true');

             if (questionStatus[currentQuestion] === 'correct') {
                selectedOptionElement.classList.add('correct');
            } else {
                selectedOptionElement.classList.add('incorrect');
                 // Also highlight the correct one if wrong answer selected
                 allOptions.forEach(opt => {
                     if (opt.textContent === correctAnswerText) {
                         opt.classList.add('correct');
                     }
                 });
            }


            updateFeedback();
            updateButtons();
            createProgressSteps(); // Update step colors
            disableOptions(); // Make sure options are disabled after selection

             // Auto-focus next button for smoother flow
             DOM.buttons.next.focus();
        }

         // Disable options after an answer is selected
        function disableOptions() {
            const options = document.querySelectorAll('.option');
            options.forEach(option => {
                 option.style.pointerEvents = 'none'; // Prevent further clicks
                 option.setAttribute('tabindex', '-1'); // Remove from tab order
            });
        }


        // Met à jour le feedback après une réponse
        function updateFeedback() {
            const question = quizQuestions[currentQuestion];
            const status = questionStatus[currentQuestion];
            if (!status) return; // No feedback if not answered

            let feedbackHTML = '';
            if (status === 'correct') {
                feedbackHTML = `
                    <div class="feedback-correct">
                        <h3><i class="fas fa-check-circle"></i> Correct !</h3>
                        <p>${question.explanation || ''}</p>
                    </div>
                `;
            } else {
                feedbackHTML = `
                    <div class="feedback-incorrect">
                        <h3><i class="fas fa-times-circle"></i> Incorrect</h3>
                        <p>La bonne réponse était : <strong>${question.correctAnswer}</strong></p>
                        <p>${question.explanation || ''}</p>
                    </div>
                `;
            }
            DOM.quiz.feedback.innerHTML = feedbackHTML;
            DOM.quiz.feedback.classList.add('visible');
        }

        // Met à jour l'état des boutons de navigation
        function updateButtons() {
            DOM.buttons.prev.disabled = currentQuestion === 0;
            DOM.buttons.next.disabled = selectedAnswers[currentQuestion] === null;

            if (currentQuestion === quizQuestions.length - 1) {
                DOM.buttons.next.style.display = 'none';
                DOM.buttons.submit.style.display = 'inline-block';
                DOM.buttons.submit.disabled = selectedAnswers[currentQuestion] === null;
            } else {
                DOM.buttons.next.style.display = 'inline-block';
                DOM.buttons.submit.style.display = 'none';
            }
        }

        // Met à jour la barre de progression
        function updateProgressBar() {
            const progressPercentage = ((currentQuestion + 1) / quizQuestions.length) * 100;
            DOM.quiz.progress.bar.style.width = `${progressPercentage}%`;
        }

        // Passe à la question suivante
        function goToNextQuestion() {
            if (currentQuestion < quizQuestions.length - 1) {
                currentQuestion++;
                showQuestion();
            }
             // Safety check: if somehow called on last question, trigger results
             else if (currentQuestion === quizQuestions.length - 1) {
                 showResults();
             }
        }

        // Revient à la question précédente
        function goToPreviousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                 // No need to record time going back, just display
                 startTime = null; // Prevent timer update while viewing previous
                showQuestion();
            }
        }

        // Affiche l'écran des résultats
        function showResults() {
            stopTimer();

            // Calculate final stats
            const accuracy = Math.round((score / quizQuestions.length) * 100);
            const validTimes = questionTimes.filter(t => t > 0); // Filter out unanswered/navigated back
            const avgTime = validTimes.length ? (validTimes.reduce((a, b) => a + b, 0) / validTimes.length).toFixed(1) : 0;
            const fastest = validTimes.length ? Math.min(...validTimes) : 0;
            const slowest = validTimes.length ? Math.max(...validTimes) : 0;

            // Display score and stats
            DOM.results.score.textContent = score;
            DOM.results.totalQuestions.textContent = quizQuestions.length;
            DOM.results.stats.accuracy.textContent = `${accuracy}%`;
            DOM.results.stats.avgTime.textContent = `${avgTime}s`;
            DOM.results.stats.fastestAnswer.textContent = `${fastest}s`;
            DOM.results.stats.slowestAnswer.textContent = `${slowest}s`;

            // Score message
            let message = '';
            if (accuracy === 100) message = "🎉 Excellent ! Score parfait !";
            else if (accuracy >= 80) message = "👍 Très bien ! Vous maîtrisez bien le sujet.";
            else if (accuracy >= 50) message = "🙂 Pas mal ! Continuez à pratiquer.";
            else message = "💪 Ne baissez pas les bras ! Chaque erreur est une leçon.";
            DOM.results.message.innerHTML = `<p>${message}</p>`;

            // Display summary
            displaySummary();

             // Update and display certificate
            DOM.results.certificate.score.textContent = score;
            DOM.results.certificate.total.textContent = quizQuestions.length;
            DOM.results.certificate.date.textContent = new Date().toLocaleDateString('fr-FR');
             if (score >= Math.ceil(quizQuestions.length * 0.6)) { // Show certificate if score is >= 60%
                 DOM.results.certificate.container.classList.remove('hidden');
             } else {
                 DOM.results.certificate.container.classList.add('hidden');
             }


            // Update share text
             const shareTextTemplate = DOM.results.shareText.value;
             DOM.results.shareText.value = shareTextTemplate
                 .replace('[SCORE]', score)
                 .replace('[TOTAL]', quizQuestions.length);


            // Transition screens
             DOM.screens.quiz.classList.add('fade-out');
             setTimeout(() => {
                DOM.screens.quiz.classList.add('hidden');
                DOM.screens.quiz.classList.remove('fade-out');
                DOM.screens.result.style.display = 'block'; // Change display from none
                DOM.screens.result.classList.add('fade-in');
                 DOM.screens.result.focus(); // Focus results container
            }, 300);
        }

        // Génère et affiche le résumé des réponses
        function displaySummary() {
            let summaryHTML = '';
            quizQuestions.forEach((q, index) => {
                const userAnswer = selectedAnswers[index];
                const status = questionStatus[index];
                const isCorrect = status === 'correct';
                const icon = isCorrect ? 'fa-check-circle correct-answer' : (status === 'incorrect' ? 'fa-times-circle wrong-answer' : 'fa-minus-circle');

                summaryHTML += `
                    <div class="summary-item">
                        <div class="summary-question">
                           ${index + 1}. ${q.question}
                        </div>
                        <div class="summary-answer ${isCorrect ? 'correct-answer' : 'wrong-answer'}">
                            ${userAnswer !== null ? `Votre réponse: ${userAnswer}` : 'Non répondu'}
                            <i class="fas ${icon}" aria-hidden="true"></i>
                        </div>
                        ${!isCorrect && userAnswer !== null ? `<div class="summary-correct-answer">Bonne réponse: ${q.correctAnswer}</div>` : ''}
                    </div>
                `;
            });
            DOM.results.summary.innerHTML = summaryHTML;
        }

        // Recommence le quiz
        function restartQuiz() {
             DOM.screens.result.classList.add('fade-out');
             setTimeout(() => {
                DOM.screens.result.style.display = 'none'; // Hide results
                DOM.screens.result.classList.remove('fade-out');
                 initQuiz(); // Restart the quiz process
                // Optionally, go back to welcome screen:
                // DOM.screens.welcome.classList.remove('hidden');
                // DOM.screens.welcome.classList.add('fade-in');
            }, 300);
        }

        // Copie le texte de partage
        function copyShareText() {
            DOM.results.shareText.select();
            DOM.results.shareText.setSelectionRange(0, 99999); // For mobile devices
            try {
                navigator.clipboard.writeText(DOM.results.shareText.value).then(() => {
                    // Success feedback
                    const originalText = DOM.buttons.copy.innerHTML;
                    DOM.buttons.copy.innerHTML = '<i class="fas fa-check"></i> Copié !';
                    DOM.buttons.copy.disabled = true;
                    setTimeout(() => {
                        DOM.buttons.copy.innerHTML = originalText;
                        DOM.buttons.copy.disabled = false;
                    }, 1500);
                }, (err) => {
                    // Error feedback (fallback for older browsers)
                    console.error('Erreur de copie:', err);
                    alert("Erreur lors de la copie. Veuillez copier manuellement.");
                });
            } catch (err) {
                console.error('Erreur de copie (catch):', err);
                 alert("Erreur lors de la copie. Veuillez copier manuellement.");
            }
        }

        // Exporte les résultats (simplifié en texte)
        function exportResults() {
            let exportText = `Résultats du Quiz Français\n`;
            exportText += `Score: ${score}/${quizQuestions.length}\n`;
            exportText += `Précision: ${DOM.results.stats.accuracy.textContent}\n`;
            exportText += `Temps moyen: ${DOM.results.stats.avgTime.textContent}\n\n`;
            exportText += `Détail des réponses:\n`;

            quizQuestions.forEach((q, index) => {
                exportText += `\nQ${index + 1}: ${q.question}\n`;
                exportText += `   Votre réponse: ${selectedAnswers[index] || 'Non répondu'}\n`;
                if (questionStatus[index] !== 'correct') {
                    exportText += `   Bonne réponse: ${q.correctAnswer}\n`;
                }
                exportText += `   Statut: ${questionStatus[index] || 'Non répondu'}\n`;
                 if(timerEnabled && questionTimes[index] > 0) {
                    exportText += `   Temps: ${questionTimes[index]}s\n`;
                 }
            });

            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'resultats_quiz_francais.txt';
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href); // Clean up
        }

        // Imprime les résultats/certificat
        function printResults() {
            // Temporairement cacher les éléments non désirés pour l'impression
            const elementsToHide = document.querySelectorAll('body > *:not(.quiz-container), .quiz-container > *:not(#result), #result > *:not(.certificate, h1, .score-highlight, #score-message), .buttons, .social-share, .stats-container, .cta-container, #summary-container, footer');
            elementsToHide.forEach(el => el.classList.add('print-hidden'));

             // Add a print-specific class to body for potential CSS overrides
            document.body.classList.add('printing-certificate');


            // Assurer que le certificat est visible pour l'impression si masqué
            const certWasHidden = DOM.results.certificate.container.classList.contains('hidden');
            if (certWasHidden) {
                DOM.results.certificate.container.classList.remove('hidden');
            }

            window.print(); // Déclenche l'impression

            // Restaurer l'affichage après impression (timeout pour laisser le temps au dialogue d'impression)
             setTimeout(() => {
                elementsToHide.forEach(el => el.classList.remove('print-hidden'));
                 if (certWasHidden) {
                    DOM.results.certificate.container.classList.add('hidden');
                 }
                document.body.classList.remove('printing-certificate');
             }, 500);
        }

    </script>
     <!-- CSS pour masquer les éléments lors de l'impression -->
    <style>
        @media print {
            body.printing-certificate {
                margin: 0;
                padding: 0;
                background-color: white; /* Force background for print */
            }
            .print-hidden {
                display: none !important;
            }
             /* Styles spécifiques pour l'impression du certificat */
            body.printing-certificate .quiz-container {
                 box-shadow: none;
                 border: none;
                 padding: 0;
                 margin: 0;
                 width: 100%;
                 max-width: 100%;
            }
             body.printing-certificate #result {
                 padding: 20px; /* Add some padding for print */
            }
             body.printing-certificate .certificate {
                 border: 2px solid black; /* Ensure border prints */
                 box-shadow: none;
                 margin-top: 0;
            }
             body.printing-certificate .certificate h2,
            body.printing-certificate .certificate-name,
            body.printing-certificate .certificate-score {
                color: black !important; /* Force black color for print */
                 border-bottom-color: black !important;
            }
             body.printing-certificate .certificate p,
             body.printing-certificate .certificate-date {
                 color: #333 !important;
             }
        }
        /* Styles pour le timer masqué */
        .timer-hidden #timer-value {
            display: none;
        }
    </style>
</body>
</html>
